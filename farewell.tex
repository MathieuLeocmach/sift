\documentclass{beamer}
\usetheme{Boadilla}
\usecolortheme{crane}
\usefonttheme[stillsansseriflarge, stillsansserifsmall]{serif}

\usepackage{fontspec}
\setmainfont[Numbers=OldStyle]{Tex Gyre Pagella}
\setsansfont[Ligatures=Rare, Numbers=OldStyle, StylisticSet=4]{MEgalopolis Extra}
\newfontfamily \jap {Ume P Gothic}


%proper math and math symbols
%\usepackage{amsmath}
\usepackage{amssymb}

\usepackage{siunitx}

\usepackage{multirow}

% Allow the usage of graphics (.jpg, .png, etc.) in the document
\usepackage{graphicx}
\usepackage{tikz}
\usetikzlibrary{arrows,shapes,backgrounds, positioning, intersections, decorations.markings, decorations.shapes, mindmap, shapes.geometric, matrix, patterns}

\usepackage{pgfplots}
%\usepgfplotslibrary{units}
\usepgfplotslibrary{groupplots}
\usepgfplotslibrary{external}
\tikzset{external/system call={lualatex \tikzexternalcheckshellescape -halt-on-error -interaction=batchmode -jobname "\image" "\texsource"}}
\tikzexternalize
\tikzset{external/force remake=false}

%bibliography
\usepackage{natbib}
%\usepackage{bibentry}
\def\newblock{\hskip .11em plus .33em minus .07em}

\institute{\jap{田中研}}
\title[Farewell presentation]{FAREWELL PRESENTATION}
\author[M. Leocmach]{Mathieu Leocmach}
\date{6th August 2012}

\begin{document}
\tikzset{every mark/.append style={scale=0.8}}
\pgfplotsset{every axis/.append style={small}}

\AtBeginSection[]{
	\addtocounter{framenumber}{-1}
	\begin{frame}[plain]
		\tableofcontents[currentsection, hideothersubsections]
	\end{frame}
}

\begin{frame}[plain]
	\titlepage
\end{frame}

\begin{frame}[plain]
	\tableofcontents[hidesubsections]
\end{frame}
\setcounter{framenumber}{0}

\section{Multiscale tracking}

\begin{frame}{Colloids as model atoms}
	\begin{columns}
	\column{0.5\textwidth}
	\begin{block}{Colloids are used as "experimental simulations" of statistical physics}
	\begin{itemize}
	\item Hard spheres
	\item Sticky spheres (short range attraction)
	\item Repulsive sphere (long range repulsion)
	\item Mixtures
	\item External fields
	\end{itemize}
	\end{block}
	
	\column{0.5\textwidth}
	Rich phase diagram mimicking atomic systems.
%	\begin{itemize}
%	\item Colloidal gas
%	\item Colloidal liquid
%	\item Colloidal crystal(s)
%	\item Colloidal glass
%	\item Colloidal gel
%	\end{itemize}
	\includegraphics[width=\columnwidth]{Pusey_vanMegen}\\
	\footnotesize{\citet{pusey1986}}
	
	But also technologically useful in themselves.
	\end{columns}
\end{frame}

\begin{frame}{Confocal microscopy}
	\begin{center}\begin{columns}[c]
	\column{0.4\textwidth}
	\begin{tikzpicture}[
		font=\footnotesize, 
		decoration={markings, mark=between positions 0.1 and 1 step 0.2\columnwidth with {\arrow{stealth}}},
	]
	\draw[thick] (-0.12\columnwidth,0) -- (-0.012\columnwidth,0) (0.012\columnwidth,0) -- (0.12\columnwidth,0);
	\node[left] at (-0.12\columnwidth,0) {aperture};
	\fill[name path=dichro, cyan, rotate around={-45:(0,-0.35\columnwidth)}]  (-0.2\columnwidth,-0.34\columnwidth) rectangle (0.2\columnwidth,-0.36\columnwidth) (0, -0.34\columnwidth) node[above, black, rotate=-45] {beam splitter};
	\draw[thick] (-0.35\columnwidth,-0.23\columnwidth) -- (-0.35\columnwidth,-0.348\columnwidth) (-0.35\columnwidth,-0.362\columnwidth) -- (-0.35\columnwidth,-0.47\columnwidth);
	\node[above] at (-0.35\columnwidth,-0.23\columnwidth) {pinhole};
	\fill[cyan] (0, -\columnwidth) arc (-90:-70:0.6\columnwidth) node (lensright) {} 
		arc (70:110:0.6\columnwidth) node (lensleft) {}
		arc (-110:-90:0.6\columnwidth);
	\path[name path=lensbottom] (lensleft) arc (-110:-70:0.6\columnwidth);
	\path[name path=lenstop] (lensright) arc (70:110:0.6\columnwidth);
	\fill[orange] (-0.15\columnwidth, -1.05\columnwidth) rectangle (0.15\columnwidth, -1.15\columnwidth);
	\draw[dashed] (-0.2\columnwidth, -1.08\columnwidth) -- (0.2\columnwidth, -1.08\columnwidth);
	\node[left] at (-0.2\columnwidth, -1.08\columnwidth) {focal plane};
	\node[above] at (0,0.1\columnwidth) {light source};
	\path[name path=iray1] (0.012\columnwidth, 0.1\columnwidth) -- (-0.12\columnwidth, -\columnwidth);
	\path[name path=iray2] (0, -1.08\columnwidth) -- (-0.15\columnwidth, -0.95\columnwidth);
	\path[name path=iray3] (-0.012\columnwidth, 0.1\columnwidth) -- (0.12\columnwidth, -\columnwidth);
	\path[name path=iray4] (0, -1.08\columnwidth) -- (0.15\columnwidth, -0.95\columnwidth);
	\draw[
		postaction={decorate}, green!80!black,
		name intersections={of=iray1 and dichro, by=x},
		name intersections={of=iray3 and dichro, by=y},
		]
		(0.012\columnwidth, 0.1\columnwidth) -- (x)
		(-0.012\columnwidth, 0.1\columnwidth) -- (y);
		
	\draw[
		postaction={decorate}, green!80!black, dashed, dash pattern=on 5pt off 5pt, dash phase=0pt,
		name intersections={of=iray1 and dichro, by=x}, 
		name intersections={of=iray1 and lenstop, by=a}, 
		name intersections={of=iray2 and lensbottom, by=b},
		name intersections={of=iray4 and lensbottom, by=c},
		name intersections={of=iray3 and lenstop, by=d},
		name intersections={of=iray3 and dichro, by=y},
		] 
		(x) -- (a) -- (b) -- (0, -1.08\columnwidth)
		(y) -- (d) -- (c) -- (0, -1.08\columnwidth);
	\draw[postaction={decorate}, red!80!black, 
		name intersections={of=iray1 and dichro, by=x}, 
		name intersections={of=iray3 and dichro, by=y},
		] 
		(x) -- (-0.41\columnwidth, -0.362\columnwidth) 
		(y) -- (-0.41\columnwidth, -0.348\columnwidth);
	\draw[postaction={decorate}, red!80!black, dashed, dash pattern=on 5pt off 5pt, dash phase=10pt,
		name intersections={of=iray1 and dichro, by=x}, 
		name intersections={of=iray1 and lenstop, by=a}, 
		name intersections={of=iray2 and lensbottom, by=b},
		name intersections={of=iray4 and lensbottom, by=c},
		name intersections={of=iray3 and lenstop, by=d},
		name intersections={of=iray3 and dichro, by=y},
		] 
		(0, -1.08\columnwidth) -- (b) -- (a) -- (x) 
		(0, -1.08\columnwidth) -- (c) -- (d) -- (y);
	\draw[thick, blue] (-0.39\columnwidth, -0.33\columnwidth) arc (90:270:0.025\columnwidth);
	\node[above left, rotate=90] at (-0.39\columnwidth, -0.33\columnwidth) {light detector};
	\path[name path=badray1] (0,0) -- (-0.18\columnwidth, -1.1\columnwidth);
	\path[name path=badray2] (0, -1.12\columnwidth) -- (-0.3\columnwidth, -0.85\columnwidth);
	\path[name path=badray3] (0,0) -- (0.18\columnwidth, -1.1\columnwidth);	
	\path[name path=badray4] (0, -1.12\columnwidth) -- (0.3\columnwidth, -0.85\columnwidth);
	\draw[dotted,
		name intersections={of=badray1 and dichro, by=x}, 
		name intersections={of=badray1 and lenstop, by=a}, 
		name intersections={of=badray2 and lensbottom, by=b},
		name intersections={of=badray4 and lensbottom, by=c},
		name intersections={of=badray3 and lenstop, by=d},
		name intersections={of=badray3 and dichro, by=y},
		] 
		(0, -1.12\columnwidth) -- (b) -- (a) -- (x) --  (-0.35\columnwidth, -0.38\columnwidth)
		(0, -1.12\columnwidth) -- (c) -- (d) -- (y) --  (-0.35\columnwidth, -0.33\columnwidth);
	\end{tikzpicture}
	\column{0.5\textwidth}
	\begin{tikzpicture}
	\matrix[matrix of nodes, ampersand replacement=\&, nodes={anchor=center}]
	{
		$XY$ slice \& \includegraphics[width=0.5\columnwidth]{sliceXY} \\
		$XZ$ slice \& \includegraphics[width=0.5\columnwidth]{sliceXZ} \\
	};
	\end{tikzpicture}
	\end{columns}\end{center}
\end{frame}

\begin{frame}{Monodisperse particle tracking}
	\begin{columns}[T]
	\column{0.3\textwidth}
	Original image\\
	\includegraphics[width=\textwidth]{dillute_raw}
	
	\bigskip
	\includegraphics[width=\textwidth]{dillute_raw_gp_raster}
	\column{0.3\textwidth}
	Blurred\\
	\includegraphics[width=\textwidth]{dillute_filtered}
	
	\bigskip
	\includegraphics[width=\textwidth]{dillute_filtered_gp_raster}
	\column{0.3\textwidth}
	Local maxima\\
	\includegraphics[width=\textwidth]{dillute_centers}
	
	\bigskip
	\includegraphics[width=\textwidth]{dillute_centers_gp_raster}
	\end{columns}
	
	
	Resolution up to $\SI{1/10}{px}$ via subpixel resolution methods.
	
	\bigskip
	
	\footnotesize{\citet{Crocker1996}}
\end{frame}

\begin{frame}{Monodisperse particle tracking}
	\begin{columns}[T]
	\column{0.3\textwidth}
	\centering
	Not enough blur\\
	\includegraphics[width=\textwidth]{dillute_notblured}
	\column{0.3\textwidth}
	\centering
	Good blur\\
	\begin{tikzpicture}
		\node[inner sep=0, anchor=south west]{\includegraphics[width=\textwidth]{dillute_filtered}};
		\fill[red!50!white] (9/64.0*\textwidth, 17/64.0*\textwidth) rectangle (10/64.0*\textwidth, 18/64.0*\textwidth);
		\fill[red!50!white] (19/64.0*\textwidth, 44/64.0*\textwidth) rectangle (20/64.0*\textwidth, 45/64.0*\textwidth);
		\fill[red!50!white] (28/64.0*\textwidth, 27/64.0*\textwidth) rectangle (29/64.0*\textwidth, 28/64.0*\textwidth);
		\fill[red!50!white] (34/64.0*\textwidth, 42/64.0*\textwidth) rectangle (35/64.0*\textwidth, 43/64.0*\textwidth);
		\fill[red!50!white] (51/64.0*\textwidth, 11/64.0*\textwidth) rectangle (52/64.0*\textwidth, 12/64.0*\textwidth);
	\end{tikzpicture}
	\column{0.3\textwidth}
	\centering
	Too much blur\\
	\includegraphics[width=\textwidth]{dillute_tooblured}
	\end{columns}
	\begin{itemize}
	\item We must choose \alert{the right} blurring radius.
	\item Ok for monodisperse particles
	\item Problematic for polydisperse
	\end{itemize}
\end{frame}

\begin{frame}{Same method with polydisperse particles}
	\begin{columns}[T]
	\column{0.3\textwidth}
	\centering
	{\strut{}Multiple centres}\\
	\includegraphics[width=\textwidth]{dillute_smaller_blur0_5}
	\column{0.3\textwidth}
	\centering
	{\strut{}Misplaced centres}\\
	\includegraphics[width=\textwidth]{dillute_smaller_blur1}
	\column{0.3\textwidth}
	\centering
	{\strut{}Overlook small}\\
	\includegraphics[width=\textwidth]{dillute_smaller_blur1_5}
	\end{columns}
	\begin{itemize}
	\item There is no \alert{right} blurring radius $\Rightarrow$ We always have errors.
	\item We cannot extract the sizes of the particles, important for the physics of the system.
	\begin{itemize}
		\item Volume fraction
		\item Neighbours
	\end{itemize}
	\end{itemize}
\end{frame}

\begin{frame}{Not better in 3D}
	\begin{center}
	\begin{tabular}{ccc}
	\includegraphics[width=0.18\textwidth]{comp3D_monoscale_r20_crop} & %
	\includegraphics[width=0.18\textwidth]{comp3D_monoscale_r25_crop} & %
	\includegraphics[width=0.18\textwidth]{comp3D_monoscale_r30_crop} \\ 
	\includegraphics[width=0.18\textwidth]{comp3D_monoscale_r35_crop} & %
	\includegraphics[width=0.18\textwidth]{comp3D_monoscale_r40_crop} & %
	\includegraphics[width=0.18\textwidth]{comp3D_monoscale_r45_crop} \\ 
	\end{tabular} 
	\end{center}
\end{frame}

\begin{frame}{Scale space}
	\footnotesize{Scale space,~\citet{Lindeberg1993}\\ Scale-invariant feature transform,~\citet{Lowe2004}}
	
	\begin{tikzpicture}[%
		minus/.style={
			shape=circle, draw, inner sep=0, %
			text height=1.5ex,text depth=.25ex,%
			node distance=0.5%
			},%
		]
		\begin{groupplot}[%
			group style={
				group size=2 by 1,%
				},%
			anchor=north,%
			width=0.5\textwidth,%
			xtick=\empty, ytick=\empty,%
			xlabel={position}, xlabel near ticks, ylabel near ticks, %
			no markers,
			title style={text height=1.5ex,text depth=.25ex, anchor=center},%
			]
			\nextgroupplot[%
				ylabel={intensity},%
				title={Increasing Gaussian blur},%
			]
				\addplot[black] table[x expr=\coordindex, y expr=\thisrowno{0}]{gaussians.txt};
				\addplot[blue] table[x expr=\coordindex, y expr=\thisrowno{1}-2]{gaussians.txt};
				\node at (current plot end) (g1) {};
				\addplot[blue!67!red] table[x expr=\coordindex, y expr=\thisrowno{2}-4]{gaussians.txt};
				\node at (current plot end) (g2) {};
				\addplot[blue!33!red] table[x expr=\coordindex, y expr=\thisrowno{3}-6]{gaussians.txt};
				\node at (current plot end) (g3) {};
				\addplot[red] table[x expr=\coordindex, y expr=\thisrowno{4}-8]{gaussians.txt};
				\node at (current plot end) (g4) {};
				
			\only<1>{
			\nextgroupplot[%
				title={Difference of Gaussians},%
				ymax=0.45,%
			]
				\addplot+[smooth, blue] table[x expr=\coordindex, y expr=\thisrowno{2}-\thisrowno{1}]{gaussians.txt};
				\node at (current plot begin) (DoG1) {};
				\addplot+[smooth, blue!67!red] table[x expr=\coordindex, y expr=\thisrowno{3}-\thisrowno{2}-0.2]{gaussians.txt};
				\node at (current plot begin) (DoG2) {};
				\addplot+[smooth, blue!33!red] table[x expr=\coordindex, y expr=\thisrowno{4}-\thisrowno{3}-0.4]{gaussians.txt};
				\node at (current plot begin) (DoG3) {};
			}
			\only<2>{
			\nextgroupplot[%
				title={Difference of Gaussians},%
			]
				\addplot+[smooth, blue] table[x expr=\coordindex, y expr=\thisrowno{2}-\thisrowno{1}]{gaussians.txt};
				\addplot+[smooth, blue!67!red] table[x expr=\coordindex, y expr=\thisrowno{3}-\thisrowno{2}]{gaussians.txt};
				\node at (current plot begin) (DoG2) {};
				\addplot+[smooth, blue!33!red] table[x expr=\coordindex, y expr=\thisrowno{4}-\thisrowno{3}]{gaussians.txt};
				\draw[->, thick] (rel axis cs:0.5,0.0015) -- (rel axis cs:0.5,0.075);
			}
				
		\end{groupplot}
		\only<1>{
		\node[minus, blue] (diff1) [left=of DoG1] {-};
		\draw [->, blue] (g1) -- (diff1);
		\draw [->, blue!67!red] (g2) -- (diff1);
		\draw [->, blue] (diff1) -- (DoG1);
		}
		\node[minus, blue!67!red] (diff2) [left=of DoG2] {-};
		\draw [->, blue!67!red] (g2) -- (diff2);
		\draw [->, blue!33!red] (g3) -- (diff2);
		\draw [->, blue!67!red] (diff2) -- (DoG2);
		\only<1>{
		\node[minus, blue!33!red] (diff3) [left=of DoG3] {-};
		\draw [->, blue!33!red] (g3) -- (diff3);
		\draw [->, red] (g4) -- (diff3);
		\draw [->, blue!33!red] (diff3) -- (DoG3);
		}
	\end{tikzpicture}
	
	\begin{itemize}
		\item The magnitude of the DoG should be maximized at the center of the blob.
		\item<2> The optimal scale, which depends on the size of the blob, should be detected.
	\end{itemize}
\end{frame}

\begin{frame}{Locating particles in both scale and space}
	\begin{columns}[T]
	\column{0.7\textwidth}
	\def\svgwidth{\columnwidth}
	\input{sift_octave1.pdf_tex}
	\def\svgwidth{\columnwidth}
	\input{sift_octave0.pdf_tex}
	\column{0.3\textwidth}
	\def\svgwidth{\columnwidth}
	\input{sift_localmin.pdf_tex}
	Minima of the DoG images are detected by neighbourhood search.
	\end{columns}
	
	\footnotesize{\citet{Lindeberg1993, Lowe2004}}
\end{frame}



\begin{frame}{Optimal scale}
	For a binary disk of radius $R$, the DoG response is minimum for a scale $\sigma^{*} \propto R$. The proportionality constant is known analytically.
	
	\begin{columns}[T]
	\column{0.3\textwidth}
	\begin{tikzpicture}
		\usebeamercolor{palette primary}
		\fill[black] (-0.5\columnwidth,-0.5\columnwidth) rectangle (0.5\columnwidth, 0.5\columnwidth);
		\fill[white] (0,0) circle (0.25\columnwidth);
		\draw[->, fg, thick] (0,0) -- (0.25\columnwidth, 0);
		\node[below, fg] at (0.125\columnwidth, 0) {$R$};
	\end{tikzpicture}
	\column{0.7\textwidth}
	\begin{tikzpicture}
		\begin{axis}[
			width=0.8\columnwidth,%
			xmin=0, ymax=0, xmax=5, %
			xlabel=$R/\sigma^*$, ytick={0},%
			ylabel={DoG response}, ylabel near ticks, %
			no marks,%
			]
			\addplot+[smooth] {exp(-x^2/2) - exp(-x^2/2/2^(2/3))};
		\end{axis}
	\end{tikzpicture}
	\end{columns}
\end{frame}

\begin{frame}{Isolated sphere}
	\begin{tikzpicture}
	\pgfplotsset{cycle list name=black white, clip marker paths=true,}
	\begin{axis}[%
		name=size,
		width=0.5\columnwidth,%
		height=0.5\columnwidth,%
		xlabel={Input radius}, ylabel={Output radius},%
		extra x ticks={3.47}, extra x tick labels={}, extra tick style={grid=major},%
		ytick={2,4,...,14},
		axis background/.style={fill=white},%
		]
		\addplot+[only marks, mark size=0.5, mark=o] table [x index=0, y expr ={\thisrowno{1}}] {multiscale_relative_sizes.out};
		\addplot+[no marks, domain=1.5:14] {x};
	\end{axis}
	\begin{axis}[%
		name=errorsize,
		at={(0.5\columnwidth,0)},%
		width=0.5\columnwidth,%
		height=0.5\columnwidth,%
		xlabel={Input radius (px)}, ylabel={$R$ relative error (\%)},%
		extra x ticks={3.47}, extra x tick labels={}, extra tick style={grid=major},%
		extra y ticks={0}, extra y tick labels={},%
		ylabel near ticks,
		]
		\addplot table [x index=0, y expr ={100*(\thisrowno{1}/\thisrowno{0}-1)}] {multiscale_relative_sizes.out};
	\end{axis}
	\end{tikzpicture}
\end{frame}

\begin{frame}{Two spheres}
	\tikzset{external/force remake=false}
	\begin{columns}[c]
	\column{0.55\textwidth}
	\begin{tikzpicture}
	\begin{groupplot}[%
		group style={
				group size=1 by 2,%
				},%
		height=0.5\textheight,%
		width=\columnwidth,%
		xlabel={$r_{ij}$ (px)}, 
		xmin=8, xmax=18, xtick={8,...,17},%
		extra tick style={grid=major},%
		]
		\nextgroupplot[%
			ylabel={$r_{ij}$ error (\SI{0.01}{px})},%
			extra y ticks={0}, extra y tick labels={},%
			]
		\addplot table [x index=0, y expr ={(\thisrowno{2}-\thisrowno{1}-\thisrowno{0})*100}] {close_neighbours3D.out};
		\draw (axis cs:12,-6) circle[radius=0.05\textwidth] (axis cs:16,-6) circle[radius=0.05\textwidth];
		\draw[dashed] (axis cs:12,-6) -- (axis cs:12,-9) (axis cs:16,-9) -- (axis cs:16,-6);
		\draw[<->] (axis cs:12,-9) -- (axis cs:16,-9) node[midway, above] {$r_{ij}$};
		\draw[->] (axis cs:11.05,-6) -- +(0,0.05\textwidth,0) node[midway, left] {\SI{4}{px}};
		\draw[->, very thick] (axis cs:16,-6) -- (axis cs:14,-6);
	
	\nextgroupplot[
		ylabel={$R$ (px)},%
		extra y ticks={4}, extra y tick labels={},%
		legend style={legend pos=south east}
		]
		\addplot table [x index=0, y index=4] {close_neighbours3D.out};
		\addplot+[mark=square] table [x index=0,y index=6] {close_neighbours3D.out};
		\legend{No correction, One iteration};
	\end{groupplot}
	\end{tikzpicture}
	\column{0.45\textwidth}
	Error at contact $\approx \SI{0.1}{px}$, like monodisperse tracking.
	
	\bigskip
	
	The DoG response at the center of particle $i$ is a superposition of the contribution of each (neighbouring) particle.
	\[
	%\forall i,\quad 
	DoG_i = \sum_j DoG(r_{ij}, R_j)
	\label{eq:superpos}
	\]
	\end{columns}
\end{frame}

\begin{frame}{Many particles}
	\tikzset{external/force remake=false}
	Thanks John for the data
	
	\begin{tikzpicture}
	\pgfplotsset{cycle list name=black white, clip marker paths=true,}
	\begin{axis}[%
		name=finite,
		at={(0,-1.35\columnwidth)},%
		height=0.5\columnwidth,%
		width=\columnwidth,%
		area legend,
		const plot, no marks,%
		xlabel={$R$ (px)}, ylabel={Size distribution},%
		%xmin=8, xmax=18,%
		extra tick style={grid=major},%
		extra x ticks={5.298}, extra x tick labels={},%
		ymin=0,%		
		legend style={legend pos=north west, cells={anchor=west}}
		]
		\addplot+[pattern=north west lines] file {john_exact_mono_large_init.hist} \closedcycle;
		\addplot+[gray, fill=gray, semitransparent] file {john_exact_mono_large_cor1.hist} \closedcycle;
		\addplot+[pattern=dots] file {john_exact_mono_large_cor2.hist};
		\legend{No correction, One iteration, Two iterations};
		\draw[decorate,decoration=brace] (axis cs:4.75, 200) -- (axis cs:5.05, 200) node[midway, above] {edges};
	\end{axis}
	\end{tikzpicture}
\end{frame}



\begin{frame}{Deconvolution}
	\tikzset{external/force remake=false}
	\begin{columns}[c]
	\column{0.66\textwidth}
	$y = x \star h + \epsilon$ with $h$ the point spread function.
	\begin{tikzpicture}
		\begin{groupplot}[%
		group style={
				group name=pics,
				group size=3 by 1,%
				horizontal sep=0.0075\textwidth,
				vertical sep=0.0075\textwidth,
				},%
		width=0.3\textwidth,%
		height=0.33\textwidth,%
		xmin=0,xmax=50,ymin=0,ymax=55,%
		axis lines=none,%
		scale only axis=true,%
		point meta=explicit symbolic,%
		scatter/@pre marker code/.code={%
        	\pgfmathparse{10*\pgfplotspointmetatransformed*\pgfplotsunitxlength}%
        	%\pgfplotstransformcoordinatex{\pgfplotspointmetatransformed}
            \def\markopts{mark=o,black,mark size=\pgfmathresult}%
            \expandafter\scope\expandafter[\markopts]
            },%
        scatter/@post marker code/.code={\endscope} 
		]
		\nextgroupplot[title={Original}]
			\addplot graphics [xmin=0,xmax=50,ymin=0,ymax=55]{Zelong_original};
		\nextgroupplot[title={Blurred}]
			\addplot graphics [xmin=0,xmax=50,ymin=0,ymax=55]{Zelong_blurred};
			\addplot+[only marks, scatter] table [x index=1, y expr={55-\thisrowno{2}}, meta index=3] {Z_elong.xyz};
		\nextgroupplot[title={Deconvolved}]
			\addplot graphics [xmin=0,xmax=50,ymin=0,ymax=55]{Zelong_deconvolved};
			\addplot+[only marks, scatter] table [x index=1, y expr={55-\thisrowno{2}}, meta index=3] {Z_elong_deconv.xyz};
		\end{groupplot}
	\end{tikzpicture}
	\begin{itemize}
	\item If the system is isotropic, the spectrum along $z$ must be the same as the spectrum along $x$ ou $y$.\\ $\Rightarrow$ Possible to measure the \textsc{psf}.
	\item No need to deconvolve the noisy original image, we can use the first Gaussian blurred version.
	\end{itemize}
	
	
	\column{0.33\textwidth}
	\begin{tikzpicture}
		\begin{axis}[%
			anchor=outer south west,
			width=\columnwidth,%
			height=0.9\textheight,%
			xlabel = {$r$ [\si{\micro\metre}]}, ylabel={$g(r)$},%
			xlabel near ticks, ylabel near ticks,
			xmin=0,xmax=4,ymin=0,%
			no marks,%
			]
			\addplot file {cp0.34.rdf};
			\addplot file {cp0.34_deconv.rdf};
		\end{axis}
	\end{tikzpicture}
	\end{columns}
\end{frame}

\section{Heterogeneous crystallisation}

\begin{frame}{Our colloids}
	\begin{columns}
	\column{0.5\textwidth}
	\begin{center}
	\rotatebox{90}{\qquad \small{SEM image}}\includegraphics[width=0.8\columnwidth, height=0.6\columnwidth]{SEM}
	\end{center}
	\structure{Solvent}
	\begin{itemize}
		\item Cis-decalin
		\item Cyclohexylbromide
	\end{itemize}
	Matching
	\begin{itemize}
		\item Optical index
		\item Density (with $T$ control)
	\end{itemize}
	\column{0.5\textwidth}
	\begin{block}{PMMA particles}
		\begin{itemize}
			\item $\sigma \simeq \SI{3.3}{\micro\metre}$
			\item $\Delta \simeq 6\%$ not Gaussian
		\end{itemize}
		Hard spheres
		\begin{itemize}
			\item Sterically stabilized
			\item Salt to screen charges\\ (Debye length $<\SI{100}{\nano\metre}$)
		\end{itemize}
	\end{block}
	\end{columns}
\end{frame}

\begin{frame}<1-3>{Size distribution}
	\tikzset{external/force remake=false}
	\begin{tikzpicture}
	\begin{axis}[%
		name=hist,
		width=\columnwidth, height=0.5\textheight,%
		%scale only axis,
		xlabel={Diameters [$\si{\micro\metre}$]},%
		xmin=1, xmax=5,
		axis y line*=left,
		ymin=0, ytick=\empty,%
		ylabel={Size distribution},%
		ylabel near ticks,
		legend style={legend pos=north west}, area legend,
		]
		\addplot[ybar, ybar interval, gray!50, fill=gray!50] file {SEM_size_distrib.txt} \closedcycle;
		\legend{\textsc{sem}}
	\end{axis}
	\only<2->{\begin{axis}[%
		name=hist2,
		width=\columnwidth, height=0.5\textheight,%
		xmin=1, xmax=5,
		axis y line*=right,
		ymin=0, ytick=\empty,%
		no marks,%
		]
		\addplot+[dashed] table[x expr ={2*\thisrow{r}}, y=all] {all_ico_icongb_mrco_X.rdist};
		\addlegendentry{In situ};
		\only<3>{\addplot table [x expr ={2*\thisrow{r}/1.25}, y index=1] {all_ico_icongb_mrco_X.rdist};}%
		\draw<3>[->, ultra thick] (axis cs:3.15,3) -- (axis cs: 3.9, 3) node[midway, above] {swelling};%
	\end{axis}}
	\end{tikzpicture}
\end{frame}

\begin{frame}{Are the sizes correct ?}
\tikzset{external/force remake=false}
\begin{tikzpicture}
	\begin{groupplot}[%
		group style={group size=2 by 1, horizontal sep=5em},%
		width=0.45\textwidth,%
		]
	\nextgroupplot[%
		xmin=2, xmax=6, xlabel={Optical radius [px]},%
		ymin=0, ymax=20,%
		ylabel={Position of the first peak of $g_R(r)$ [px]},
		y label style={align=center, text width=0.5\textheight},%
		]
		\addplot+[black,forget plot, no marks, domain=2:6] {3*x};
		\addplot+[black,only marks, mark=o] file {rdf_peak_pos_radius.out};
		
	\nextgroupplot[%
		%width=0.5\columnwidth, height=0.5\columnwidth,%
		xmin=0, xmax=1.5,%
		xlabel ={$r/\sigma_\text{peak}$, $\hat{r}$},%
		ymin=0,%
		ylabel=$g(r)$, ylabel near ticks,%
		no marks,%
		legend style={legend pos=north west}, 
		]
		\addplot+[dashed] file {yon6.rdf};
		\addplot file {yon6.srdf};
		\legend{$g(r)$, $g(\hat{r})$};
	\end{groupplot}
	\end{tikzpicture}
	
	Sizes $\Rightarrow\phi=0.60\Rightarrow$ Glass
\end{frame}

\begin{frame}{Structures in the glass}
	\tikzset{external/force remake=false}
	\begin{tikzpicture}
	\definecolor{BlueViolet}{rgb}{0.62352, 0.372549, 0.623529};
		\node[anchor=south east] (t000) {\includegraphics[height=0.7\textheight]{mrco_ico_small_t000.png}};
		\node[anchor=south west] (t299) {\includegraphics[height=0.7\textheight]{mrco_ico_small_t299.png}};
		\node[below=0 of t000.south] {$t=0$};
		\node[below=0 of t299.south] {$t=\SI{40}{\hour}$};
		\draw[->] (0,0.1\textheight) -- (0,0.5\textheight) node[above]{$z$};
		\matrix[%
		matrix of nodes, right=-0.5em of t299.east, ampersand replacement=\&,
		column 1/.style={right, text height=0.8em, text depth=0.2em},%
		column 2/.style={left, circle, shade, inner sep=0.008\textwidth},%
		] (l)
	{
		Crystal-like \& |[ball color=red]|{}\\
		Icosahedra \& |[ball color=BlueViolet]|{}\\
		Small \& |[ball color=green]|{}\\
	};
	\end{tikzpicture}
\end{frame}

\begin{frame}{Size distribution of the structures}
	\tikzset{external/force remake=false}
	\begin{tikzpicture}
	\begin{groupplot}[%
		group style={
			group name=distrib,
			group size=1 by 2,
			},%
		width=\columnwidth,%
		height=0.5\textheight,%
		no marks,%
		xlabel={$R$ [\si{\micro\metre}]}, xmin=0.8, xmax=2.5,%
		ylabel={Size distribution}, ymin=0, ymax=12,%
		legend style={legend pos=north west},
		]
		\nextgroupplot
		\addplot table[x=r, y=all] {all_ico_icongb_mrco_X.rdist};
		\addplot table[x=r, y=mrco] {all_ico_icongb_mrco_X.rdist};
		\addplot table[x=r, y=X] {all_ico_icongb_mrco_X.rdist};
		\legend{all, \textsc{mrco}, crystalline};
		
		\nextgroupplot
		\addplot table[x=r, y=all] {all_ico_icongb_mrco_X.rdist};
		\addplot table[x=r, y=ico] {all_ico_icongb_mrco_X.rdist};
		\addplot table[x=r, y=icongb] {all_ico_icongb_mrco_X.rdist};
		\legend{all, ico. centre, ico. surf.};
	\end{groupplot}
	\end{tikzpicture}
\end{frame}

\begin{frame}{Density profiles}
	\tikzset{external/force remake=false}
	\begin{tikzpicture}
		\begin{groupplot}[%
			group style={
				group name=profiles,
				group size=2 by 2,
				y descriptions at=edge left,%
				x descriptions at=edge bottom,%
				horizontal sep=0,
				vertical sep=0,
			},%
			width=0.4\textwidth,
			height=0.45\textheight,%
			ymin=0, ymax=1,%
			ytick={0,0.2,...,1},%
			no marks,%
			ylabel near ticks,%
			xlabel=$z/(2R_\text{peak})$,%
			xmin=1, xmax=26,%
			axis on top,
			]
		\nextgroupplot[ylabel={$\rho$ large}]
		\addplot+[gray!50, fill=gray!50] table[x index=0, y index=1]{large_small_mrco_t000.gauss.zhist} \closedcycle;
		\addplot+[thick] table[x index=0, y index=3]{large_small_mrco_t000.gauss.zhist};
		\addplot+[black] table[x index=0, y index=1]{large_small_mrco_t000.zhist};
		\node at (rel axis cs:0.5, 0.8) {$t=0$};
		
		\nextgroupplot
		\addplot+[gray!50, fill=gray!50] table[x index=0, y index=1]{large_small_mrco_t200.gauss.zhist} \closedcycle;
		\addplot+[thick] table[x index=0, y index=3]{large_small_mrco_t200.gauss.zhist};
		\addplot+[black] table[x index=0, y index=1]{large_small_mrco_t200.zhist};
		\node at (rel axis cs:0.5, 0.8) {$t=\SI{40}{\hour}$};
		
		\nextgroupplot[ymax=0.15, ytick={0,0.1}, ylabel={$\rho$ small}]
		\addplot+[green!50!gray, fill=green!50!gray] table[x index=0, y index=2]{large_small_mrco_t000.gauss.zhist} \closedcycle;
		\addplot+[thick] table[x index=0, y index=3]{large_small_mrco_t000.gauss.zhist} ;
		\addplot+[green!30!black] table[x index=0, y index=2]{large_small_mrco_t000.zhist};
		
		\nextgroupplot[ymax=0.15, ytick={0,0.1}]
		\addplot+[green!50!gray, fill=green!50!gray] table[x index=0, y index=2]{large_small_mrco_t200.gauss.zhist} \closedcycle;
		\addplot+[thick] table[x index=0, y index=3]{large_small_mrco_t200.gauss.zhist};
		\addplot+[green!30!black] table[x index=0, y index=2]{large_small_mrco_t200.zhist};
		\end{groupplot}
		\node[below right=0 of profiles c2r1.outer north east] (t299) {\includegraphics[height=0.6\textheight]{mrco_ico_small_t299.png}};
	\end{tikzpicture}
\end{frame}

\begin{frame}{Small particles must be expelled}
	\tikzset{external/force remake=false}
	\begin{tikzpicture}
		\matrix[matrix of nodes, inner sep=1pt, ampersand replacement=\&] (a)%
		{%
			\includegraphics[width=0.25\columnwidth]{small_boo000.png} \& %
			\includegraphics[width=0.25\columnwidth]{small_boo060.png} \& %
			\includegraphics[width=0.25\columnwidth]{small_boo120.png}\\
			\includegraphics[width=0.25\columnwidth]{small_boo180.png} \& %
			\includegraphics[width=0.25\columnwidth]{small_boo240.png} \& %
			\includegraphics[width=0.25\columnwidth]{small_boo299.png}\\%
		};
		\begin{axis}[%
		name=b,
		at={(a.south east)},%
		anchor=below south west,%
		xmin=0,xmax=10, ymin=0, ymax=0.55,%
		width=5em,%
		height=0.55\columnwidth,%
		axis x line=none,%
		axis y line*=right,%
		axis on top,
		]
		\addplot graphics[xmin=0,xmax=10, ymin=0, ymax=0.55] {color_bar.png};
		\end{axis}
		\node[above= 0 of b.outer north] {$Q_6$};
	\end{tikzpicture}
	
	Every \SI{12}{\hour}
\end{frame}

\section{Initial stage of gelation}

\begin{frame}{Procedure}
	\tikzset{external/force remake=false}
	\begin{tikzpicture}[
		pic3d/.style={inner sep=0}, %
		]%
		\begin{scope}%[xshift=0.1\textwidth, yshift=-0.025\textwidth]
			%\fill[blue!10] (0.01\textwidth,0) rectangle (0.2\textwidth, 0.19\textwidth);
			\draw (0, 0.12\textwidth) rectangle (0.01\textwidth,0) %
				(0.2\textwidth, 0.12\textwidth) rectangle (0.21\textwidth,0)%
				(0, 0.13\textwidth) rectangle (0.01\textwidth,0.19\textwidth)%
				(0.2\textwidth, 0.13\textwidth) rectangle (0.21\textwidth,0.19\textwidth)%
				(0, 0.19\textwidth) rectangle (0.21\textwidth, 0.195\textwidth);		
			\filldraw[gray] (0, 0.12\textwidth) rectangle (0.038\textwidth, 0.13\textwidth) 
				(0.042\textwidth, 0.13\textwidth) rectangle (0.098\textwidth, 0.12\textwidth)
				(0.102\textwidth, 0.13\textwidth) rectangle (0.158\textwidth, 0.12\textwidth)
				(0.162\textwidth, 0.13\textwidth) rectangle (0.21\textwidth, 0.12\textwidth);
			\fill[green, semitransparent] (0.1\textwidth, 0.17\textwidth) -- (0.06\textwidth, 0.22\textwidth) -- (0.14\textwidth, 0.22\textwidth) -- cycle;
			\filldraw[lightgray] (0.05\textwidth, 0.22\textwidth) arc[start angle=180,delta angle=180,x radius=0.05\textwidth, y radius=0.01\textwidth] --cycle;
			\begin{scope}[radius=0.008\textwidth, ball color=red!80]
				\shade(0.08\textwidth, 0.175\textwidth) circle;
				\shade(0.11\textwidth, 0.16\textwidth) circle;
				\shade(0.05\textwidth, 0.15\textwidth) circle;
				\shade(0.03\textwidth, 0.18\textwidth) circle;
				\shade(0.14\textwidth, 0.14\textwidth) circle;
				\shade(0.16\textwidth, 0.165\textwidth) circle;
			\end{scope}
			\draw[%
				gray, decoration={coil, segment length=0.0025\textwidth, amplitude=0.0025\textwidth},
				]
				(0.06\textwidth, 0.1745\textwidth)
				decorate{++(-0.0025\textwidth,-0.0025\textwidth) -- ++(0.0045\textwidth,0.0045\textwidth) -- ++(0,-0.0045\textwidth) -- ++(-0.005\textwidth,+0.005\textwidth) }
				(0.17\textwidth, 0.1345\textwidth)
				decorate{++(-0.0025\textwidth,-0.0025\textwidth) -- ++(0.0045\textwidth,0.0045\textwidth) -- ++(0,-0.0045\textwidth) -- ++(-0.005\textwidth,+0.005\textwidth) }
				(0.172\textwidth, 0.14\textwidth)
				decorate{++(-0.0025\textwidth,-0.0025\textwidth) -- ++(0.0045\textwidth,0.0045\textwidth) -- ++(0,-0.0045\textwidth) -- ++(-0.005\textwidth,+0.005\textwidth) }
				(0.145\textwidth, 0.16\textwidth)
				decorate{++(-0.0025\textwidth,-0.0025\textwidth) -- ++(0.0045\textwidth,0.0045\textwidth) -- ++(0,-0.0045\textwidth) -- ++(-0.005\textwidth,+0.005\textwidth) }
				(0.19\textwidth, 0.18\textwidth)
				decorate{++(-0.0025\textwidth,-0.0025\textwidth) -- ++(0.0045\textwidth,0.0045\textwidth) -- ++(0,-0.0045\textwidth) -- ++(-0.005\textwidth,+0.005\textwidth) }
				(0.09\textwidth, 0.14\textwidth)
				decorate{++(-0.0025\textwidth,-0.0025\textwidth) -- ++(0.0045\textwidth,0.0045\textwidth) -- ++(0,-0.0045\textwidth) -- ++(-0.005\textwidth,+0.005\textwidth) }
				(0.03\textwidth, 0.15\textwidth)
				decorate{++(-0.0025\textwidth,-0.0025\textwidth) -- ++(0.0045\textwidth,0.0045\textwidth) -- ++(0,-0.0045\textwidth) -- ++(-0.005\textwidth,+0.005\textwidth) }
				;
			\begin{scope}[blue, every node/.style={circle, inner sep=0.002\textwidth, fill}]
				\draw[decorate,decoration={shape backgrounds,shape=circle,shape size=0.002\textwidth}, fill=blue, step=0.01\textwidth] %
				(0.012\textwidth,0) grid (0.19\textwidth, 0.08\textwidth);
				\draw[decorate,decoration={shape backgrounds,shape=circle,shape size=0.002\textwidth}, fill=blue, step=0.017\textwidth] %
				(0.012\textwidth, 0.08\textwidth) grid (0.195\textwidth, 0.115\textwidth);
				%(0.17\textwidth,  0.0745\textwidth) -- (0.145\textwidth, 0.05\textwidth) -- (0.0514\textwidth, 0.09\textwidth)%
				%(0.03\textwidth, 0.045\textwidth) -- (0.07\textwidth, 0.07\textwidth);
			\end{scope}
			\begin{scope}[blue!20,->, line width=0.005\textwidth]
					\draw (0.16\textwidth, 0.08\textwidth) -- (0.16\textwidth, 0.11\textwidth);
					\draw (0.1\textwidth, 0.08\textwidth) -- (0.1\textwidth, 0.11\textwidth);
					\draw (0.04\textwidth, 0.08\textwidth) -- (0.04\textwidth, 0.11\textwidth);
			\end{scope}
			\begin{scope}[right, font=\footnotesize]
				\node at (0.21\textwidth,0.21\textwidth) {Objective lens};
				\node at (0.21\textwidth,0.17\textwidth) {Observation cell};
				\node at (0.21\textwidth,0.125\textwidth){Filter};
				\node[above right,blue] at (0.21\textwidth,0.08\textwidth) {Salt diffusion};
				\node[above right] at (0.21\textwidth, 0) {Reservoir};
			\end{scope}
		\end{scope}
		
		
		\begin{semilogyaxis}[%
			at={(0.45\textwidth,0)}, anchor=left of south west,%
			name={phasediag},%
			width=0.5\textwidth, height=0.5\textheight,%
			xmin=0, xmax=40, xlabel={$\phi$ [\%]},
			ymin=0.08, ymax=3.5, ylabel={$c_p$ [\si{\gram\per\liter}]},%
			ytick={0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1,2}, yticklabels={0.1,0.2,,,0.5,,,,,1,2},%
			legend columns=2,%
			legend style={font=\footnotesize, at={(0.5,1.03)}, anchor=south},%
			only marks,%
			]%
			\addplot[sharp plot, no marks] table [x expr=100*\thisrowno{0}, y index=1] {gasliquid_sg.phd};
			\addplot[sharp plot, no marks, dashed] table [x expr=100*\thisrowno{0}, y index=1] {gasliquid_bg.phd};
			\addplot[sharp plot, no marks, dotted] table [x expr=100*\thisrowno{0}, y index=1] {fluidsolid_f.phd};
			\addplot table [x index=1,y index=2] {phase_diag_gel.csv};
			\addplot table [x index=1,y index=2] {phase_diag_fluid.csv};
			\addplot table [x index=1,y index=2] {phase_diag_transient.csv};
			\addplot table [x index=1,y index=2] {phase_diag_binodal.csv};
			\legend{spinodal, binodal, gas-solid, gel, fluid, transient, binodal};
			\node[circle, draw, gray] at (axis cs:7.4, 0.98) (155C) {};
		\end{semilogyaxis}
	\end{tikzpicture}
\end{frame}

\begin{frame}{Observations}
	\tikzset{external/force remake=false}
	\begin{tikzpicture}[
		pic3d/.style={inner sep=0}, %
		]		
		\begin{scope}[pic3d]
			\node (threeD_20min) {\includegraphics[width=0.3\textwidth]{155C_percolation_1645_p2size_t084.png}};
			\node[left=0.01\textwidth of threeD_20min] (threeD_10min){\includegraphics[width=0.3\textwidth]{155C_percolation_1645_p2size_t044.png}};
			\node[left=0.01\textwidth of threeD_10min] (threeD_5min) {\includegraphics[width=0.3\textwidth]{155C_percolation_1645_p2size_t024.png}};
			\node[below=0.01\textwidth of threeD_5min] (threeD_30min) {\includegraphics[width=0.3\textwidth]{155C_1715_ageing_p2size_t00.png}};
			\node[right=0.01\textwidth of threeD_30min] (threeD_40min) {\includegraphics[width=0.3\textwidth]{155C_1715_ageing_p2size_t20.png}};
			\node[right=0.01\textwidth of threeD_40min] (threeD_50min) {\includegraphics[width=0.3\textwidth]{155C_1715_ageing_p2size_t40.png}};
		\end{scope}
		%\node[right=0.01\textwidth of threeD_10min] (threeD_20min){\includegraphics[width=0.3\textwidth]{3d_draft_20min.jpg}};
		\begin{scope}[above right]
			\node at (threeD_5min.south west) {\SI{5}{\minute}};
			\node at (threeD_10min.south west) {\SI{10}{\minute}};
			\node at (threeD_20min.south west) {\SI{20}{\minute}};
			\node at (threeD_30min.south west) {\SI{30}{\minute}};
			\node at (threeD_40min.south west) {\SI{40}{\minute}};
			\node at (threeD_50min.south west) {\SI{50}{\minute}};
		\end{scope}
	\end{tikzpicture}
\end{frame}

\begin{frame}{Conclusion}
\begin{itemize}
\item Still a lot to analyse in Tsurusawa-san's data
\item Collaboration with John about the correlation of structural entropy $s_2$.
\item Please, use my particle tracking code
\end{itemize}
\begin{center}
\huge{\textsf{THANK YOU FOR 7 WONDERFUL YEARS}}
\end{center}


\end{frame}

\appendix
\newcounter{finalframe}
\setcounter{finalframe}{\value{framenumber}}

\begin{frame}[allowframebreaks]{References}
	%\begin{thebibliography}{Lacevic2003}
		\bibliographystyle{plainnat}
		\bibliography{sift}
	%\end{thebibliography}
\end{frame}
\setcounter{framenumber}{\value{finalframe}}

\end{document}